---
//@ts-nocheck
import Layout from "../../layouts/Layout.astro";
import pb from "../../utils/pb";
import { Collections } from "../../utils/pocketbase-types";
import { ui } from "../../i18n/ui.js";

const locale = (Astro.locals.lang as "en" | "fr") ?? "en";

const svgs = await pb.collection(Collections.Svgs).getFullList();

const user = Astro.locals.user; // Récupère l'utilisateur connecté
const svgList = await pb.collection(Collections.Svgs).getFullList({
  sort: "-created", // Trie les SVGs du plus récent au plus ancien
  filter: `user = "${user.id}"`, // Filtre pour n'afficher que les SVGs de l'utilisateur
});
---

<Layout title="{ui[locale].gallery.title}">
  <h1 class="text-2xl font-bold mb-4">{ui[locale].gallery.title}</h1>

  {
    svgs.length === 0 ? (
      <p class="text-gray-500">{ui[locale].gallery.noSvgs}</p>
    ) : (
      <div class="grid grid-cols-2 gap-4">
        {svgs.map((s) => (
          <div class="border rounded-xl p-4 bg-base-200">
            <h2 class="font-semibold mb-2">{s.name}</h2>
            <div class="svg-container mb-2" set:html={s.code_svg} />
            <pre class="bg-gray-100 p-2 rounded text-xs overflow-x-auto mb-2">
              {s.code_svg}
            </pre>

            <button
              class="btn btn-sm btn-outline"
              type="button"
              onclick={`navigator.clipboard.writeText(${JSON.stringify(s.code_svg)})`}
            >
              {ui[locale].gallery.copyButton}
            </button>

            <a class="btn btn-sm btn-primary ml-2" href={`/gallery/${s.id}`}>
              {ui[locale].gallery.viewDetails}
            </a>
          </div>
        ))}
      </div>
    )
  }
</Layout>
